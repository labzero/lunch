= form_for(:advance_request, as: :advance_request, url: advances_preview_path, html: {method: :post, class: 'add-advance-form'}) do |f|
  = render layout: 'add_advance', title: t('advances.add_advance.titles.add') do
    = render layout: 'shared/etransact_status_message', locals: {etransact_status: @etransact_status} do
      .advances-add.row
        .column-9x3-left
          = render 'shared/input_field', icon: :dollar, placeholder: t('dashboard.quick_advance.advance_placeholder'), field_name: 'advance_request[amount]', field_value: fhlb_formatted_number(@selected_amount, optional_number: true, html: false)
          = f.hidden_field(:type)
          = f.hidden_field(:term)
          = f.hidden_field(:id)
          - if @limited_pricing_message
            .limited-pricing-message.icon-info-before
              = simple_format(@limited_pricing_message)
              %p= t('dashboard.quick_advance.deadline')
          %p.add-advance-action-message= t('dashboard.quick_advance.preview.initiate')
          .add-advance-instructions
            %p= t('dashboard.quick_advance.advance_instruction')
      .advances-add.row
        .column-9x3-left
          .advance-rates-table-wrapper{data: {active_term_type: @active_term_type}}
            .advance-rates-table-toggle
              %span{data: {active_term_type: :vrc}}= t('advances.vrc_rates')
              %span{data: {active_term_type: :frc}}= t('advances.frc_rates')
            - if feature_enabled?('add-advance-custom-term')
              .advance-funding-date-wrapper
                %span= t('advances.funding.funding_date')
                %span= t('advances.funding.funding_today', date: fhlb_date_standard_numeric(@today))
                %span.advance-alternate-funding-date-edit= t('advances.funding.edit')
              .advance-alternate-funding-date-wrapper
                %span= t('advances.funding.set_alternate')
                %span.advance-alternate-funding-date-close= t('global.close')
                %ul
                  %li
                    = render 'shared/radio_button', id: 'funding_date_today', name: 'alternate-funding-date', checked: true, text:fhlb_date_standard_numeric(@today), value: @today.iso8601
                    %label{for: :funding_date_today}
                      %span= t('global.today')
                      = t('advances.funding.default')
                  %li
                    = render 'shared/radio_button', id: 'funding_date_next', name: 'alternate-funding-date', checked: false, text:fhlb_date_standard_numeric(@next_day), value: @next_day.iso8601
                    %label{for: :funding_date_next}
                      %span= t('advances.funding.next_business')
                  %li
                    = render 'shared/radio_button', id: 'funding_date_skip', name: 'alternate-funding-date', checked: false, text:fhlb_date_standard_numeric(@skip_day), value: @skip_day.iso8601
                    %label{for: :funding_date_skip}
                      %span= t('advances.funding.skip_day')
            %table.advance-rates-table.add-advance-table-loading{data: {fetch_rates_url: advances_fetch_rates_path({advance_request: {id: @advance_request_id}})}}
              %thead
                %tr
                  %th
                  %th= t('dashboard.quick_advance.table.axes_labels.standard')
                  %th{colspan: 3}= t('dashboard.quick_advance.table.axes_labels.securities_backed')
                %tr.add-advance-column-labels
                  %th
                  %th
                    .add-advance-cell-wrapper= t('dashboard.quick_advance.table.whole_loan')
                  %th
                    .add-advance-cell-wrapper= t('dashboard.quick_advance.table.agency')
                  %th
                    .add-advance-cell-wrapper= t('dashboard.quick_advance.table.aaa')
                  %th
                    .add-advance-cell-wrapper= t('dashboard.quick_advance.table.aa')
              %tbody
                = render 'rates_table', advance_terms: @advance_terms, advance_types: @advance_types, loading: true, selected_type: @selected_type, selected_term: @selected_term
          .advances-actions
            = link_to(t('global.cancel'), advances_manage_path, class: 'secondary-button cancel-advance')
            = f.submit({disabled: true, class: ["primary-button initiate-add-advance"], value: t('advances.actions.review')})
          %small
            %p.add-advances-footer= t('advances.add_advance.terms')
        = render 'borrowing_capacity', profile: @profile